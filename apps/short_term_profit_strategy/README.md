# 短线逐利策略

短线逐利策略专注于捕捉短期价格波动带来的交易机会，基于多因子分析和严格的风险控制机制。

## 策略概述

该策略利用价格变化、持仓量变化和成交量比率等多个因子来识别潜在的爆发性行情，并通过严格的入场和出场规则控制风险。

### 最新优化

- **实时信号识别优化**: 所有因子计算已优化为聚焦于最近5分钟的变化，提高对短期爆发行情的敏感度
- **价格变化计算**: 现在比较当前K线与前一K线的收盘价，更准确地捕捉价格突变
- **持仓量变化计算**: 结合价格方向调整持仓量信号强度，区分多空资金流向
- **成交量计算优化**: 使用均值和中位数加权组合评估成交量异常，降低极端值影响

## 主要功能

1. **标的筛选模块**: 筛选流动性好、波动性适中的标的
2. **买入信号增强**: 多因子复合验证
3. **卖出信号优化**: 主动止盈、固定止损、强制平仓
4. **风险控制系统**: 通过在信号中携带风控参数，使用仓位管理器中的风控功能
5. **因子分析功能**: 可分析各个因子表现，识别市场热点

## 交易信号逻辑

### 买入信号
策略使用三个主要因子来确定买入信号:

1. **价格因子**: 当前5分钟K线相对于前一个5分钟K线的价格变化
   - 默认阈值: 2%

2. **持仓量因子**: 当前5分钟K线相对于前一个5分钟K线的持仓量变化
   - 默认阈值: 5%
   - 根据价格方向进行信号强度调整

3. **成交量因子**: 当前5分钟成交量相对于前30分钟平均成交量的比率
   - 默认阈值: 3倍
   - 使用均值和中位数加权，减少极端值影响

只有当这三个因子同时满足条件时，才会生成买入信号。

### 卖出信号
策略使用以下规则进行卖出:

1. **固定止盈**: 默认5%
2. **固定止损**: 默认3%
3. **追踪止损**: 可选启用，默认距离2%
4. **强制平仓条件**:
   - 持仓量下降超过阈值(默认3%)
   - 价格下跌超过阈值(默认2%)

## 配置选项

主要配置参数包括:

```json
{
  "strategy": {
    "top_volume_limit": 100,
    "min_atr_pct": 0.5,
    "max_price_change_pct": 15.0,
    "min_price_increase_pct": 2.0,
    "min_position_growth_pct": 5.0,
    "volume_increase_ratio": 3.0,
    "fixed_take_profit_pct": 5.0,
    "fixed_stop_loss_pct": 3.0,
    "use_trailing_stop": true,
    "trailing_distance_pct": 2.0,
    "cooling_period_minutes": 30,
    "max_daily_trades": 50,
    "max_daily_loss_pct": 50.0
  }
}
```

## 使用方法

### 运行策略

```bash
python apps/short_term_profit_strategy/main.py
```

### 因子分析

策略提供因子分析功能，可以评估当前市场中各个标的的因子表现，有助于调整策略参数和了解市场状况。

运行分析脚本:
```bash
python scripts/analyze_factors.py --host <IP地址> --port 8080 --max-symbols 50
```

支持的参数:
- `--host`: HTTP服务器主机名或IP (默认: localhost)
- `--port`: HTTP服务器端口 (默认: 8080)
- `--top`: 返回排名前多少的数据 (默认: 10)
- `--max-symbols`: 最多分析多少个标的 (默认: 20, 设为0表示全部)
- `--format`: 输出格式 (默认: table, 可选: json)

### API接口

策略提供以下HTTP API接口:

- `/api/trigger`: 触发信号处理
  - 支持的类型:
    - `scan`: 触发市场扫描
    - `status`: 获取策略状态
    - `reset`: 重置每日计数器
    - `update_params`: 更新策略参数
    - `open`: 手动开仓
    - `close`: 手动平仓
- `/api/close_all`: 关闭所有持仓
- `/api/status`: 获取策略状态
- `/api/factor_analysis`: 分析策略因子

## 性能监控

策略会持续监控自身性能并每4小时动态调整参数。策略会根据市场波动性自动调整买入和卖出阈值，以适应不同的市场环境。 